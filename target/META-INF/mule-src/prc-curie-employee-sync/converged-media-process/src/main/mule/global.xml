<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:anypoint-mq="http://www.mulesoft.org/schema/mule/anypoint-mq"
	xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
	xmlns:os="http://www.mulesoft.org/schema/mule/os"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:api-gateway="http://www.mulesoft.org/schema/mule/api-gateway"
	xmlns:tls="http://www.mulesoft.org/schema/mule/tls" xmlns:apikit="http://www.mulesoft.org/schema/mule/mule-apikit"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd 
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/api-gateway http://www.mulesoft.org/schema/mule/api-gateway/current/mule-api-gateway.xsd
http://www.mulesoft.org/schema/mule/mule-apikit http://www.mulesoft.org/schema/mule/mule-apikit/current/mule-apikit.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/tls http://www.mulesoft.org/schema/mule/tls/current/mule-tls.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd
http://www.mulesoft.org/schema/mule/anypoint-mq http://www.mulesoft.org/schema/mule/anypoint-mq/current/mule-anypoint-mq.xsd">
	<http:listener-config name="converged-media-process-httpListenerConfig">
        <http:listener-connection host="${host}" port="${https.port}" protocol="HTTPS">
			<tls:context >
				<tls:key-store type="jks" path="keystore.jks" alias="mule" keyPassword="${tls.keySecret}" password="${tls.keyStoreSecret}" />
			</tls:context>
		</http:listener-connection>
    </http:listener-config>
    <apikit:config name="converged-media-process-config" api="converged-media-process.raml" outboundHeadersMapName="outboundHeaders" httpStatusVarName="httpStatus" />
	<configuration-properties doc:name="Configuration properties" doc:id="87d9e529-4caf-4d11-9022-201d9ca31ea6" file="properties/config.yaml" />
	<http:request-config name="HTTP_Request_configuration_Proposals" doc:name="HTTP Request configuration" doc:id="0dc14f25-5339-4f4a-80ae-23cc393a928d" >
		<http:request-connection protocol="HTTPS" host="${sample.host}" port="${sample.port}" />
	</http:request-config>
	<api-gateway:autodiscovery apiId="${api_id}" ignoreBasePath="true" doc:name="API Autodiscovery" doc:id="a3e934c9-e40a-4a25-b6c8-cbc8f8c5ee12" flowRef="converged-media-process-main"/>
	<os:object-store name="Object_store" doc:name="Object store" doc:id="061c95b5-f671-446f-951d-db1778a2b24c" />
	<anypoint-mq:config name="Anypoint_MQ_Config" doc:name="Anypoint MQ Config" doc:id="7d7e759f-f5b0-4b89-bbe3-49f3ce67f7d4" >
		<anypoint-mq:connection url="${forwardResponse.url}" clientId="${forwardResponse.clientId}" clientSecret="${forwardResponse.clientSecret}" />
	</anypoint-mq:config>
	<error-handler name="globalError_Handler" doc:id="c24e108f-aec3-4eb3-92ef-e9babfe070d0" >
	<on-error-propagate type="APIKIT:BAD_REQUEST, HTTP:BAD_REQUEST, REQUEST:BAD_REQUEST" enableNotifications="true" logException="true">
                <ee:transform>
                    <ee:message>
					<ee:set-payload resource="dataweave/error/bad-request.dwl" />
                    </ee:message>
                    <ee:variables>
					<ee:set-variable resource="dataweave/httpStatus.dwl" variableName="httpStatus" />
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:NOT_FOUND">
                <ee:transform>
                    <ee:message>
					<ee:set-payload resource="dataweave/error/notFound.dwl" />
                    </ee:message>
                    <ee:variables>
					<ee:set-variable resource="dataweave/httpStatus2.dwl" variableName="httpStatus" />
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:METHOD_NOT_ALLOWED">
                <ee:transform>
                    <ee:message>
					<ee:set-payload resource="dataweave/error/methodNotAllowed.dwl" />
                    </ee:message>
                    <ee:variables>
					<ee:set-variable resource="dataweave/httpStatus1.dwl" variableName="httpStatus" />
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
            <on-error-propagate type="APIKIT:UNSUPPORTED_MEDIA_TYPE">
                <ee:transform>
                    <ee:message>
					<ee:set-payload resource="dataweave/error/unsupportedMediaType.dwl" />
                    </ee:message>
                    <ee:variables>
					<ee:set-variable resource="dataweave/httpStatus3.dwl" variableName="httpStatus" />
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="6a341f5d-bd74-4506-bae7-910e7802c6a1" type="HTTP:UNAUTHORIZED">
			<ee:transform doc:name="Transform Message" doc:id="8496e75f-3d03-4643-8be3-45c1ffacd810" >
				<ee:message >
					<ee:set-payload resource="dataweave/error/unAuthorized.dwl" />
				</ee:message>
				<ee:variables >
					<ee:set-variable resource="dataweave/httpStatus4.dwl" variableName="httpStatus" />
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="a08e0400-6a18-4a9e-ab09-d7afd22fd124" type="HTTP:INTERNAL_SERVER_ERROR">
				<ee:transform doc:name="Transform Message" doc:id="9bee7224-8eb4-445c-96f0-3be4671b73e0" >
					<ee:message >
					<ee:set-payload resource="dataweave/error/internalServerError.dwl" />
					</ee:message>
					<ee:variables >
					<ee:set-variable resource="dataweave/httpStatus5.dwl" variableName="httpStatus" />
					</ee:variables>
				</ee:transform>
			</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="eaadc4f3-a0a3-4e30-ac67-fd52cd2f0331" type="MULE:COMPOSITE_ROUTING">
			<ee:transform doc:name="Transform Message" doc:id="e37010d5-54fc-41e7-aab7-2166bc14cfe5" >
				<ee:message >
					<ee:set-payload resource="dataweave/error/compositeError.dwl" />
				</ee:message>
				<ee:variables >
					<ee:set-variable resource="dataweave/httpStatus6.dwl" variableName="httpStatus" />
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="92493fe0-f062-47ea-94b9-13fb9a665653" type="ANY">
			<ee:transform doc:name="Transform Message" doc:id="7eeaabff-aceb-4920-a139-a7fffab0ae0a">
				<ee:message>
					<ee:set-payload resource="dataweave/error/any.dwl" />
				</ee:message>
				<ee:variables>
					<ee:set-variable resource="dataweave/httpStatus7.dwl" variableName="httpStatus" />
				</ee:variables>
			</ee:transform>
		</on-error-propagate>

	</error-handler>
	</mule>
