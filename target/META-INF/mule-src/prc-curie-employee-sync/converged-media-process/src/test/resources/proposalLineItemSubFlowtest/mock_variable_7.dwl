"%dw 2.0\noutput application/json skipNullOn=\"everywhere\"\nvar proposalId = (vars.originalPayload.proposals[0].lineItems filter(\$.lineItemDetail.adServerCode ~= payload and \$.lineItemDetail.adServerAction ~= vars.originalPayload.proposals[0].proposalHeader.adServerAction))[0].proposalId\n---\n{\n\trequestId: vars.originalPayload.requestId,\n\trequestedBy: vars.originalPayload.requestedBy,\n\trequestMode: vars.originalPayload.requestMode,\n\t\"requestI18NInfo\": {\n\t\t\"localeName\": \"United States\",\n\t\t\"localeCode\": vars.originalPayload.requestI18NInfo.localeCode,\n\t\t\"timezone\": vars.originalPayload.requestI18NInfo.timezone,\n\t\t\"currencyName\": \"United States Dollar\",\n\t\t\"currencyCode\": vars.originalPayload.requestI18NInfo.currencyCode\n\t},\n\t\"adServerInstanceId\": vars.adServerCodeInfo..adServerInstanceId[0],\n\t\"adServerCode\": vars.adServerCodeInfo..adServerCode[0],\n\t\"adServerApplicationName\": vars.adServerCodeInfo..adServerApplicationName[0],\n\t\"mediaType\": vars.adServerCodeInfo..mediaType[0],\n\tproposals: [{\n\t\tid: proposalId default \"0\",\n\t\tname: vars.originalPayload.proposals[0].name,\n\t\tstartDate: vars.originalPayload.proposals[0].startDate,\n\t\tendDate: vars.originalPayload.proposals[0].endDate,\n\t\tproposalHeader: {\n\t\t\tisProgrammatic: vars.originalPayload.proposals[0].proposalHeader.isProgrammatic,\n\t\t\ttotalBudget: {\n\t\t\t\tvalue: vars.originalPayload.proposals[0].proposalHeader.totalBudget.value\n\t\t\t},\n            salespeople: vars.adServerCodeInfo..salespeople[0] map ( salesperson , indexOfSalesperson ) -> {\n\t\t\t\tid: salesperson.id,\n\t\t\t\tisComapny: salesperson.isCompany,\n\t\t\t\tprimary: salesperson.primary\n\t\t\t},\n            traffickers: vars.adServerCodeInfo..traffickers[0] map ( trafficker , indexOfTrafficker ) -> {\n\t\t\t\tid: trafficker.id,\n\t\t\t\tisComapny: trafficker.isCompany,\n\t\t\t\tprimary: trafficker.primary\n\t\t\t}\n\t\t\t\n\t\t},\n\t\tadvertiser: {\n\t\t\tid: vars.adServerCodeInfo..advertiser.id[0],\n\t\t\t\"type\": vars.adServerCodeInfo..advertiser.\"type\"[0]\n\t\t},\n\t\tbuyer: {\n\t\t\tid: vars.adServerCodeInfo..buyer.id[0]\n\t\t},\n        sellers: vars.adServerCodeInfo..sellers[0] map ( seller , indexOfSeller ) -> {\n\t\t\tid: seller.id,\n\t\t\tisCompany: seller.isCompany,\n\t\t\tprimary: seller.primary\n\t\t}\n\t}]\n}"